mixed-port: 7890
tproxy-port: 7891

allow-lan: true
mode: Rule
log-level: error
ipv6: true
#æ§åˆ¶ Clash å‘å‡º TCP Keep Alive åŒ…çš„é—´éš”ï¼Œå‡å°‘ç§»åŠ¨è®¾å¤‡è€—ç”µé—®é¢˜çš„ä¸´æ—¶æªæ–½
keep-alive-interval: 30
#æ§åˆ¶æ˜¯å¦è®© Clash å»åŒ¹é…è¿›ç¨‹
#always å¼€å¯ï¼Œå¼ºåˆ¶åŒ¹é…æ‰€æœ‰è¿›ç¨‹
#strict é»˜è®¤ï¼Œç”± Clash åˆ¤æ–­æ˜¯å¦å¼€å¯
#off ä¸åŒ¹é…è¿›ç¨‹ï¼Œæ¨èåœ¨è·¯ç”±å™¨ä¸Šä½¿ç”¨æ­¤æ¨¡å¼
enable-process: true
find-process-mode: always

external-controller: 0.0.0.0:9090
secret: ""
#é¢æ¿é»˜è®¤Meta å¯é€‰Yacd æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å³å¯é‡æ–°åŠ è½½
external-ui: ./metacubexd
#æœ¬åœ°UIä¸‹è½½åœ°å€ï¼Œä» GitHub Pages åˆ†æ”¯è·å–
external-ui-url: "https://github.com/MetaCubeX/metacubexd/archive/refs/heads/gh-pages.zip"

#ç¼“å­˜
profile:
  store-selected: true
  store-fake-ip: true

unified-delay: true
tcp-concurrent: true
global-client-fingerprint: chrome

geodata-mode: true
geodata-loader: standard
geo-auto-update: true
geo-update-interval: 24
global-ua: clash.meta
geox-url:
  geoip: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.dat"
  geosite: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geosite.dat"
  mmdb: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/country.mmdb"
  asn: "https://github.com/xishang0128/geoip/releases/download/latest/GeoLite2-ASN.mmdb"

dns:
  enable: true
  ipv6: false
  prefer-h3: false
  use-hosts: true
  use-system-hosts: true
  respect-rules: false
  listen: 0.0.0.0:1053
  #å¯é€‰å€¼ normal/fake-ip/redir-host
  enhanced-mode: normal
  fake-ip-range: 198.18.0.0/15
  #fake-ip æ’é™¤åˆ—è¡¨
  fake-ip-filter:
    - "*"
    - "+.lan"
    - "connect.rom.miui.com"
    - "localhost.ptlogin2.qq.com"
  nameserver:
    - tls://1.0.0.1
    - tls://8.8.4.4
  nameserver-policy:
    "geosite:cn,private":
      - https://1.12.12.12/dns-query
      - https://223.5.5.5/dns-query
    "geosite:geolocation-!cn":
      - https://94.140.14.140/dns-query
      - https://1.0.0.1/dns-query

sniffer:
  enable: true
  force-dns-mapping: true
  parse-pure-ip: true
  override-destination: true
  sniff:
    HTTP:
      ports: [80, 8080-8880]
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [443, 8443]
  force-domain:
    - "+.v2ex.com"
  skip-domain:
    - "Mijia Cloud"

tun:
  enable: true
  #å¯ç”¨å€¼ï¼š system/gvisor/mixed
  stack: mixed
  device: utun0
  auto-route: true
  #auto-redirect: true
  auto-detect-interface: true
  dns-hijack:
    - "any:53"
    - "tcp://any:53"
  strict-route: true
  mtu: 9000
  route-exclude-address:
    - 192.168.0.0/16
    - fc00::/7
  #include-package:
  exclude-package:
    - android.media
    - com.tencent.mm
    - com.baidu.carlife.xiaomi
    - com.milink.service
    - com.miui.audiomonitor
    - com.miui.systemAdSolution
    - com.miui.voiceassist
    - com.xiaomi.aiasst.service
    - com.xiaomi.market
    - com.xiaomi.mi_connect_service
    - com.xiaomi.mirror
    - com.xiaomi.mis
    - com.xiaomi.xmsf

p:
  &p {
    type: http,
    interval: 3600,
    health-check: { enable: true, url: https://www.bing.com, interval: 300 },
  }

use: &use
  type: select
  use:
    - Yushe
    - Unicorn

proxy-providers:
  Yushe:
    <<: *p
    path:
    url: "https://sub.cucloud.top/api/v1/client/subscribe?token=24112b48abb66ea27dd738cbf57a40d8"

  Unicorn:
    <<: *p
    path:
    url: "https://login.91unicorn.cc/api/v1/client/subscribe?token=83c6cd989884afb6897d3a89a91f548f"

rule-anchor:
  ip: &ip { type: http, interval: 600, behavior: ipcidr, format: yaml }
  domain: &domain { type: http, interval: 600, behavior: domain, format: yaml }
  classical:
    &classical { type: http, interval: 600, behavior: classical, format: yaml }
  file: &file { type: file, interval: 600, behavior: classical, format: yaml }

rule-providers:
  BAN:
    <<: *classical
    path: ./rulesets/BAN.yaml
    url: "https://raw.githubusercontent.com/Mivimcrs/Sub-Clash/main/Clash%20config/rulesets/BAN.yaml"
  PASS:
    <<: *classical
    path: ./rulesets/PASS.yaml
    url: "https://raw.githubusercontent.com/Mivimcrs/Sub-Clash/main/Clash%20config/rulesets/PASS.yaml"
  Download:
    <<: *classical
    path: ./rulesets/Download.yaml
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Download/Download.yaml"
  PT:
    <<: *classical
    path: ./rulesets/PT.yaml
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/PrivateTracker/PrivateTracker.yaml"
  Emby:
    <<: *classical
    path: ./rulesets/Emby.yaml
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Emby/Emby.yaml"
  YouTube:
    <<: *classical
    path: ./rulesets/YouTube.yaml
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/YouTube/YouTube.yaml"
  Telegram:
    <<: *classical
    path: ./rulesets/Telegram.yaml
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Telegram/Telegram.yaml"
  Steam:
    <<: *classical
    path: ./rulesets/Steam.yaml
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Steam/Steam.yaml"
  Spotify:
    <<: *classical
    path: ./rulesets/Spotify.yaml
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Spotify/Spotify.yaml"
  Epic:
    <<: *classical
    path: ./rulesets/Epic.yaml
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Epic/Epic.yaml"
  EA:
    <<: *classical
    path: ./rulesets/EA.yaml
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/EA/EA.yaml"
  GOG:
    <<: *classical
    path: ./rulesets/GOG.yaml
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Gog/Gog.yaml"
  Discord:
    <<: *classical
    path: ./rulesets/Discord.yaml
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Discord/Discord.yaml"
  Claude:
    <<: *classical
    path: ./rulesets/Claude.yaml
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Claude/Claude.yaml"
  OpenAI:
    <<: *classical
    path: ./rulesets/OpenAI.yaml
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/OpenAI/OpenAI.yaml"
  BardAI:
    <<: *classical
    path: ./rulesets/BardAI.yaml
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/BardAI/BardAI.yaml"
  Bing:
    <<: *classical
    path: ./rulesets/Bing.yaml
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Bing/Bing.yaml"
  AICHAT-Patch:
    <<: *classical
    path: ./rulesets/AIchat-Patch.yaml
    url: "https://raw.githubusercontent.com/Mivimcrs/Sub-Clash/main/Clash%20config/rulesets/AIchat-Patch.yaml"
  Dcard:
    <<: *classical
    path: ./rulesets/Dcard.yaml
    url: "https://raw.githubusercontent.com/Mivimcrs/Sub-Clash/main/Clash%20config/rulesets/Dcard.yaml"
  Binance:
    <<: *classical
    path: ./rulesets/Binance.yaml
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Binance/Binance.yaml"
  Google:
    <<: *classical
    path: ./rulesets/Google.yaml
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Google/Google.yaml"
  Microsoft:
    <<: *classical
    path: ./rulesets/Microsoft.yaml
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Microsoft/Microsoft.yaml"
  Github:
    <<: *classical
    path: ./rulesets/Github.yaml
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/GitHub/GitHub.yaml"
  Cloudflare:
    <<: *classical
    path: ./rulesets/Cloudflare.yaml
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Cloudflare/Cloudflare.yaml"
  PROXY:
    <<: *classical
    path: ./rulesets/PROXY.yaml
    url: "https://raw.githubusercontent.com/Mivimcrs/Sub-Clash/main/Clash%20config/rulesets/PROXY.yaml"
  ChinaMax:
    <<: *classical
    path: ./rulesets/ChinaMax.yaml
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/ChinaMax/ChinaMax_Classical_No_IPv6.yaml"
  anti-AD:
    <<: *domain
    path: ./rulesets/anti-AD.yaml
    url: "https://raw.githubusercontent.com/privacy-protection-tools/anti-AD/master/anti-ad-clash.yaml"
  anti-AD-white:
    <<: *domain
    path: ./rulesets/anti-AD-white.yaml
    url: "https://raw.githubusercontent.com/privacy-protection-tools/dead-horse/master/anti-ad-white-for-clash.yaml"

pr: &pr { type: select, proxies: [ğŸ•¹ï¸, ğŸ‡­ğŸ‡°, ğŸ‡¹ğŸ‡¼, ğŸ‡¯ğŸ‡µ, ğŸ‡¸ğŸ‡¬, ğŸ‡ºğŸ‡¸, ğŸŒ, ğŸ‘€, ğŸ‡¨ğŸ‡³] }

proxies:

proxy-groups:
  - name: ğŸ•¹ï¸
    type: select
    filter: ""
    proxies:
      - ğŸ‡¯ğŸ‡µ
      - ğŸ‡¸ğŸ‡¬
      - ğŸ‡¹ğŸ‡¼
      - ğŸ‡­ğŸ‡°
      - ğŸ‡ºğŸ‡¸
      - ğŸ‘€

  - name: EMBY
    type: select
    filter: ""
    use:
      - Yushe
    proxies:
      - DIRECT

  - { name: GAME, <<: *pr }
  - { name: SPOTIFY, <<: *pr }
  - { name: TELEGRAM, <<: *pr }
  - { name: APPLE, <<: *pr }
  - { name: GOOGLE, <<: *pr }
  - { name: MICROSOFT, <<: *pr }
  - { name: AI CHAT, filter: "(?i)ç¾|us|unitedstates|united states", <<: *pr }
  - { name: DCARD, filter: "(?i)å°|tw|taiwan", <<: *pr }
  - { name: FINANCIAL, filter: "(?i)(æ–°|ç‹®|sg|singapore)", <<: *pr }
  - { name: ğŸ‡¨ğŸ‡³, type: select, proxies: [DIRECT, ğŸ•¹ï¸] }
  - { name: ğŸ‡­ğŸ‡°, type: select, <<: *use, filter: "(?i)æ¸¯|hk|hongkong|hong kong" }
  - { name: ğŸ‡¹ğŸ‡¼, type: select, <<: *use, filter: "(?i)å°|tw|taiwan" }
  - { name: ğŸ‡¯ğŸ‡µ, type: select, <<: *use, filter: "(?i)æ—¥æœ¬|jp|japan" }
  - { name: ğŸ‡¸ğŸ‡¬, type: select, <<: *use, filter: "(?i)(æ–°|ç‹®|sg|singapore)" }
  - {
      name: ğŸ‡ºğŸ‡¸,
      type: select,
      <<: *use,
      filter: "(?i)ç¾|us|unitedstates|united states",
    }
  - {
      name: ğŸŒ,
      type: select,
      <<: *use,
      filter: "(?i)^(?!.*(?:ğŸ‡­ğŸ‡°|ğŸ‡¯ğŸ‡µ|ğŸ‡ºğŸ‡¸|ğŸ‡¸ğŸ‡¬|ğŸ‡¨ğŸ‡³|æ¸¯|hk|hongkong|å°|tw|taiwan|æ—¥|jp|japan|æ–°|sg|singapore|ç¾|us|unitedstates)).*",
    }

  - { name: ğŸ‘€, type: select, <<: *use }
  - { name: ğŸ‘†, <<: *pr }
  - { name: ğŸˆ²ğŸŒ, type: select, proxies: [REJECT, DIRECT, ğŸ•¹ï¸] }

rules:
  - AND,((PROCESS-NAME,mihomo),(NOT,((IN-TYPE,inner)))),REJECT
  - AND,((PROCESS-NAME,clash),(NOT,((IN-TYPE,inner)))),REJECT
  - RULE-SET,BAN,REJECT

  #è¿›ç¨‹åˆ†æµ
  - PROCESS-NAME,com.zhiliaoapp.musically,ğŸ•¹ï¸
  - PROCESS-NAME,com.ss.android.ugc.aweme,ğŸ‡¨ğŸ‡³
  - PROCESS-NAME,com.netease.cloudmusic,ğŸ‡¨ğŸ‡³

  #ç›´è¿åˆ†æµ
  - RULE-SET,Download,ğŸ‡¨ğŸ‡³
  - RULE-SET,PT,ğŸ‡¨ğŸ‡³
  - RULE-SET,PASS,ğŸ‡¨ğŸ‡³

  #ä¸“ç”¨ä»£ç†åˆ†æµ
  - RULE-SET,PROXY,ğŸ•¹ï¸
  - RULE-SET,Dcard,DCARD
  - RULE-SET,Binance,FINANCIAL
  - GEOSITE,ehentai,ğŸ•¹ï¸
  - GEOSITE,twitter,ğŸ•¹ï¸
  - GEOSITE,telegram,TELEGRAM
  - GEOSITE,pixiv,ğŸ•¹ï¸
  - GEOSITE,spotify,SPOTIFY

  # AI CHAT
  - DOMAIN-SUFFIX,chatgpt.com,AI CHAT
  - DOMAIN-SUFFIX,oaistatic.com,AI CHAT
  - DOMAIN-SUFFIX,oaiusercontent.com,AI CHAT
  - DOMAIN-SUFFIX,openai.com,AI CHAT
  - DOMAIN-SUFFIX,openai.com.cdn.cloudflare.net,AI CHAT
  - DOMAIN-SUFFIX,openaiapi-site.azureedge.net,AI CHAT
  - DOMAIN-SUFFIX,openaicom-api-bdcpf8c6d2e9atf6.z01.azurefd.net,AI CHAT
  - DOMAIN-SUFFIX,openaicomproductionae4b.blob.core.windows.net,AI CHAT
  - DOMAIN-SUFFIX,production-openaicom-storage.azureedge.net,AI CHAT
  - DOMAIN-SUFFIX,chatgpt.com,AI CHAT
  # OpenAI è·Ÿè¸ªåŸŸå
  - DOMAIN-SUFFIX,o33249.ingest.sentry.io,ğŸˆ²ğŸŒ
  - DOMAIN-SUFFIX,openaicom.imgix.net,ğŸˆ²ğŸŒ
  # Aichat è¡¥å……è§„åˆ™
  - RULE-SET,Claude,AI CHAT
  - RULE-SET,OpenAI,AI CHAT
  - RULE-SET,BardAI,AI CHAT
  - RULE-SET,Bing,AI CHAT
  - RULE-SET,AICHAT-Patch,AI CHAT

  # Apple
  - GEOSITE,apple,APPLE
  - GEOSITE,apple-cn,APPLE

  # Google
  - GEOSITE,youtube,GOOGLE
  - RULE-SET,Google,GOOGLE
  - GEOSITE,google,GOOGLE
  #- GEOSITE,google-cn,GOOGLE

  # Microsoft
  - GEOSITE,github,ğŸ•¹ï¸
  - GEOSITE,onedrive,MICROSOFT
  - GEOSITE,microsoft,MICROSOFT

  # GAME
  - GEOSITE,steam@cn,DIRECT
  - GEOSITE,steam,GAME
  - RULE-SET,Epic,GAME
  - RULE-SET,EA,GAME
  - RULE-SET,GOG,GAME
  - RULE-SET,Discord,GAME

  - GEOSITE,geolocation-!cn,ğŸ‘†
  - GEOSITE,CN,ğŸ‡¨ğŸ‡³
  - GEOSITE,private,ğŸ‡¨ğŸ‡³
  - GEOIP,CN,ğŸ‡¨ğŸ‡³

  - DOMAIN-SUFFIX,cn,ğŸ‡¨ğŸ‡³
  - DOMAIN-KEYWORD,geosite,ğŸ•¹ï¸
  - IP-CIDR,10.0.0.0/8,DIRECT
  - IP-CIDR,172.16.0.0/12,DIRECT
  - IP-CIDR,192.168.0.0/16,DIRECT
  - IP-CIDR,127.0.0.0/8,DIRECT
  - IP-CIDR,224.0.0.0/4,DIRECT
  - IP-CIDR,240.0.0.0/4,DIRECT
  - MATCH,ğŸ‘†
